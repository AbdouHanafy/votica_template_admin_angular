<section class="users-page">
  <header class="users-page__header">
    <div>
      <h1>{{ language.t('users.title') }}</h1>
      <p>{{ language.t('users.subtitle') }}</p>
    </div>
    <div class="users-page__actions">
      <div class="view-toggle">
        <button
          type="button"
          class="view-toggle__btn"
          [class.is-active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
        >
          <span class="material-symbols-rounded">table_rows</span>
          {{ language.t('users.listView') }}
        </button>
        <button
          type="button"
          class="view-toggle__btn"
          [class.is-active]="viewMode() === 'card'"
          (click)="setViewMode('card')"
        >
          <span class="material-symbols-rounded">grid_view</span>
          {{ language.t('users.cardView') }}
        </button>
      </div>

      <app-button (click)="onAddUser()">
        <span class="material-symbols-rounded">person_add</span>
        {{ language.t('users.addUser') }}
      </app-button>
    </div>
  </header>

  @if (viewMode() === 'list') {
    <div class="view-panel view-panel--list">
      <app-card>
        <app-table
          [title]="language.t('users.allUsers')"
          [subtitle]="language.t('users.allUsersSub')"
          [columns]="usersColumns()"
          [rows]="$any(users())"
          [actions]="rowActions()"
          [pageSize]="8"
          [searchPlaceholder]="language.t('users.searchList')"
          (actionSelected)="onAction($event)"
        />
      </app-card>
    </div>
  } @else {
    <div class="view-panel view-panel--card">
      <app-card>
        <div class="card-filters">
          <input
            type="search"
            [ngModel]="cardQuery()"
            (ngModelChange)="cardQuery.set($event)"
            [placeholder]="language.t('users.searchCard')"
          />
          <select [ngModel]="cardRole()" (ngModelChange)="cardRole.set($event)">
            <option value="all">{{ language.t('users.allRoles') }}</option>
            @for (role of roles(); track role) {
              <option [value]="role">{{ role }}</option>
            }
          </select>
          <select [ngModel]="cardStatus()" (ngModelChange)="cardStatus.set($event)">
            <option value="all">{{ language.t('users.allStatuses') }}</option>
            <option value="active">{{ language.t('users.active') }}</option>
            <option value="inactive">{{ language.t('users.inactive') }}</option>
          </select>
          <app-button variant="ghost" (click)="resetCardFilters()">{{ language.t('users.reset') }}</app-button>
        </div>
      </app-card>

      <section class="users-stats">
        <article>
          <small>{{ language.t('users.totalUsers') }}</small>
          <strong>{{ totalUsers() }}</strong>
        </article>
        <article>
          <small>{{ language.t('users.active') }}</small>
          <strong>{{ activeUsers() }}</strong>
        </article>
        <article>
          <small>{{ language.t('users.inactive') }}</small>
          <strong>{{ inactiveUsers() }}</strong>
        </article>
      </section>

      <section class="users-grid">
        @for (user of filteredCardUsers(); track user.id) {
          <app-card>
            <div class="user-card">
              <div class="user-card__top">
                <img [src]="user.avatar" [alt]="user.name + ' avatar'" />
                <app-badge [label]="user.status" />
              </div>

              <div class="user-card__identity">
                <h3>{{ user.name }}</h3>
                <p>{{ user.email }}</p>
                <span>{{ user.role }}</span>
              </div>

              <div class="user-card__actions">
                <app-button variant="ghost" size="sm" (click)="onEditUser(user)">
                  <span class="material-symbols-rounded">edit</span>
                  {{ language.t('users.edit') }}
                </app-button>
                <app-button variant="danger" size="sm" (click)="onRequestDelete(user)">
                  <span class="material-symbols-rounded">delete</span>
                  {{ language.t('users.delete') }}
                </app-button>
              </div>
            </div>
          </app-card>
        } @empty {
          <app-card>
            <p class="empty-message">{{ language.t('users.noMatch') }}</p>
          </app-card>
        }
      </section>
    </div>
  }

  <app-modal
    [open]="showDeleteModal()"
    [title]="language.t('users.deleteUser')"
    [description]="deleteMessage()"
    [confirmLabel]="language.t('users.deleteUser')"
    [cancelLabel]="language.t('users.keepUser')"
    tone="danger"
    (confirm)="confirmDelete()"
    (cancel)="closeDeleteModal()"
    (close)="closeDeleteModal()"
  />
</section>
