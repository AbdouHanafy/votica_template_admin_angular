<section class="table-page">
  <header class="table-page__header">
    <h1>{{ language.t('table.data.title') }}</h1>
    <p>{{ language.t('table.data.subtitle') }}</p>
  </header>

  <app-card>
    <div class="toolbar">
      <input
        type="search"
        [ngModel]="query()"
        (ngModelChange)="query.set($event); page.set(1)"
        [placeholder]="language.t('table.data.filterDeals')"
      />
      <div class="toolbar__actions">
        <app-button variant="ghost" (click)="exportCsv()">{{ language.t('table.data.export') }}</app-button>
      </div>
    </div>

    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th (click)="setSort('id')">{{ language.t('table.data.dealId') }}</th>
            <th (click)="setSort('client')">{{ language.t('table.customer') }}</th>
            <th (click)="setSort('owner')">{{ language.t('table.data.owner') }}</th>
            <th (click)="setSort('value')">{{ language.t('table.data.value') }}</th>
            <th (click)="setSort('status')">{{ language.t('table.status') }}</th>
            <th>{{ language.t('table.actions') }}</th>
          </tr>
        </thead>
        <tbody>
          @for (row of paginated(); track row.id) {
            <tr>
              <td>{{ row.id }}</td>
              <td>
                @if (editingId() === row.id) {
                  <input class="cell-input" [(ngModel)]="row.client" />
                } @else {
                  {{ row.client }}
                }
              </td>
              <td>
                @if (editingId() === row.id) {
                  <input class="cell-input" [(ngModel)]="row.owner" />
                } @else {
                  {{ row.owner }}
                }
              </td>
              <td>${{ row.value }}</td>
              <td><app-badge [label]="row.status" /></td>
              <td class="row-actions">
                @if (editingId() === row.id) {
                  <button type="button" class="mini-btn" (click)="saveEdit()">{{ language.t('table.data.save') }}</button>
                } @else {
                  <button type="button" class="mini-btn" (click)="startEdit(row.id)">{{ language.t('table.data.inlineEdit') }}</button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <footer class="pager">
      <button type="button" class="mini-btn" (click)="page.set(page() - 1)" [disabled]="page() <= 1">{{ language.t('table.data.prev') }}</button>
      <span>{{ language.t('table.page') }} {{ page() }} / {{ totalPages() }}</span>
      <button type="button" class="mini-btn" (click)="page.set(page() + 1)" [disabled]="page() >= totalPages()">{{ language.t('table.data.next') }}</button>
    </footer>
  </app-card>
</section>
